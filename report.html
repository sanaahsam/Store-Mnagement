<!DOCTYPE html>
<html lang="en">
  <head>
    <title>STORE</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link
      href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://login2explore.com/jpdb/resources/js/0.0.3/jpdb-commons.js"></script>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/form.css" />
  </head>
  <body>
    <div class="wrapper d-flex align-items-stretch">
      <nav id="sidebar">
        <div class="custom-menu">
          <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Toggle Menu</span>
          </button>
        </div>
        <div class="p-4 pt-5">
          <h1><a href="index.html" class="logo">Store</a></h1>
          <ul class="list-unstyled components mb-5">
            <li class="active">
              <a href="index.html">Item Managment</a>
            </li>

            <li>
              <a href="inward.html">Item Inward</a>
            </li>

            <li>
              <a href="outward.html">Item Outward</a>
            </li>
            <li>
              <a href="report.html">Report Page</a>
            </li>
          </ul>

          <div class="footer" style="margin-top: 300px">
            <p>
              Copyright &copy;
              <script>
                document.write(new Date().getFullYear());
              </script>
              All rights reserved | Powered by JSON POWERDB
              <i class="icon-heart" aria-hidden="true"></i>
              <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
            </p>
          </div>
        </div>
      </nav>

      <!-- Page Content  -->
      <div id="content" class="pt-4">
        <h2 style="text-align: center">Item List</h2>
        <table id="itemTable">
          <thead>
            <tr>
              <th>Item ID</th>
              <th>Item Name</th>
              <th>Quantity</th>
              <th>Unit of Measurement</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be inserted here dynamically -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      const dbName = "Store-DB";
      const relationName = "Item-Relation";
      const Token = "764066664|7385821558786766262|764067669";
      baseUrl = "https://api.jsonpowerdb.com:5567";

      function displayItem() {
        // Build GETALL request
        let req = createGETALLRecordRequest(
          Token,
          dbName,
          relationName,
          1,
          5,
          true,
          true
        );

        jQuery.ajaxSetup({ async: false });
        let rawRes = executeCommand(req, "/api/irl");
        jQuery.ajaxSetup({ async: true });

        // Parse top-level response
        let res = typeof rawRes === "string" ? JSON.parse(rawRes) : rawRes;

        // Parse nested data string
        let dataObj =
          typeof res.data === "string" ? JSON.parse(res.data) : res.data;

        // Extract actual records
        let records = dataObj.json_records || [];

        const tableBody = document.querySelector("#itemTable tbody");
        tableBody.innerHTML = ""; // Clear existing rows

        if (records.length > 0) {
          records.forEach((item) => {
            const record = item.record; // each item has a "record" property
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${record.ItemId}</td>
                <td>${record.ItemName}</td>
                <td>${record.OpeningStocks}</td>
                 <td>${record.UOM || "-"}</td> 
            `;
            tableBody.appendChild(row);
          });
        } else {
          alert("No records found!");
        }
      }

      // Call displayItem on page load
      window.addEventListener("load", () => {
        displayItem();
      });
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
